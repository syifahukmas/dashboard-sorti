<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Operations Dashboard</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="config.js" onerror="console.log('Menggunakan Config Netlify')"></script>

    <style>
        /* --- VARIABLE & RESET --- */
        :root {
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60;
            --warning: #f39c12; --danger: #c0392b; --purple: #8e44ad; 
            --cyan: #00bcd4; --glass: rgba(255, 255, 255, 0.90);
            --glass-strong: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #eef2f7 url('https://images.unsplash.com/photo-1464037866556-6812c9d1c72e?auto=format&fit=crop&q=80&w=2000') no-repeat center center fixed;
            background-size: cover; margin: 0; padding: 20px; color: var(--primary);
        }

        /* HEADER */
        .header {
            max-width: 1200px; margin: 0 auto 30px auto; background: var(--glass-strong);
            padding: 15px 25px; border-radius: 16px; box-shadow: var(--shadow);
            display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(10px);
        }
        .header h1 { margin: 0; font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .header p { margin: 2px 0 0 0; font-size: 0.85rem; color: #7f8c8d; }

        .btn-update {
            background: var(--primary); color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; 
            font-weight: 600; font-size: 0.9rem; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;
        }
        .btn-update:hover { background: #34495e; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* PROVINCE SECTION */
        .province-section { max-width: 1200px; margin: 0 auto 50px auto; }
        .location-banner { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .location-pill { background: var(--glass-strong); padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 1.1rem; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 10px; }
        .location-pill i { color: var(--danger); }

        /* SUMMARY CARDS */
        .summary-wrapper {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;
        }
        .summary-card {
            background: var(--glass-strong); padding: 15px; border-radius: 16px; box-shadow: var(--shadow);
            position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; min-height: 90px;
        }
        .summary-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 5px; }

        .sum-sortie::before { background: var(--accent); } 
        .sum-nacl::before { background: var(--success); }  
        .sum-cao::before { background: var(--warning); }   
        .sum-total::before { background: var(--purple); }
        .sum-rain::before { background: var(--cyan); }

        .sum-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #7f8c8d; margin-bottom: 5px; }
        .sum-value { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .sum-unit { font-size: 0.8rem; font-weight: 500; color: #95a5a6; }
        .sum-date { font-size: 0.65rem; color: #2ecc71; font-weight: 600; margin-top: 5px; display: block; }

        /* AIRCRAFT CARDS */
        .dashboard-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 25px; }
        .card { background: var(--glass); border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .image-wrapper { position: relative; height: 180px; }
        .card-image { width: 100%; height: 100%; object-fit: cover; }
        
        .status-badge { position: absolute; top: 15px; right: 15px; padding: 6px 14px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; color: white; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-badge:hover { transform: scale(1.1); }
        .stby { background: var(--success); } .airborne { background: var(--accent); } .maintenance { background: var(--danger); } .off { background: #555; }

        .card-body { padding: 20px; }
        .pesawat-header { margin-bottom: 15px; }
        .pesawat-name { margin: 0; font-size: 1.4rem; font-weight: 800; color: var(--primary); }
        .pesawat-sub { margin: 0; font-size: 0.85rem; color: #7f8c8d; font-weight: 500; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: rgba(255,255,255,0.7); padding: 10px; border-radius: 10px; text-align: center; }
        .stat-label { font-size: 0.7rem; color: #95a5a6; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; display: block; }
        .stat-val { font-size: 1rem; font-weight: 700; color: var(--primary); }

        .target-box { border-top: 1px solid rgba(0,0,0,0.05); padding-top: 12px; display: flex; align-items: center; gap: 8px; color: var(--primary); font-size: 0.9rem; font-weight: 500; }
        .target-box i { color: var(--danger); }

        /* MODAL POPUP */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 320px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popUp { from{transform: scale(0.8); opacity:0} to{transform: scale(1); opacity:1} }
        .modal-box h3 { margin-top: 0; color: var(--primary); }
        .btn-status-choice { display: block; width: 100%; padding: 12px; margin-bottom: 8px; border: none; border-radius: 10px; font-weight: 700; color: white; cursor: pointer; font-size: 0.95rem; transition: transform 0.2s; }
        .btn-status-choice:hover { transform: scale(1.02); }
        .btn-cancel { background: #f1f2f6; color: #7f8c8d; margin-top: 15px; }
        .btn-cancel:hover { background: #e1e2e6; }

        @media (max-width: 600px) {
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .summary-wrapper { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div><h1><i class="fa-solid fa-plane-circle-check"></i> Flight Operations</h1><p>Real-time Monitoring</p></div>
        <a href="input.html" class="btn-update"><i class="fa-solid fa-pen-to-square"></i> Update Data</a>
    </div>

    <div class="province-section">
        <div class="location-banner"><div class="location-pill"><i class="fa-solid fa-location-dot"></i> Provinsi Aceh</div></div>
        
        <div class="summary-wrapper">
            <div class="summary-card sum-sortie"><span class="sum-label">Sortie</span><div class="sum-value" id="total-sortie-aceh">0</div></div>
            <div class="summary-card sum-nacl"><span class="sum-label">NaCl</span><div><span class="sum-value" id="total-nacl-aceh">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-cao"><span class="sum-label">CaO</span><div><span class="sum-value" id="total-cao-aceh">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-total"><span class="sum-label">Total Bahan</span><div><span class="sum-value" id="total-semai-aceh">0</span> <span class="sum-unit">Kg</span></div></div>
            
            <div class="summary-card sum-rain">
                <span class="sum-label">Curah Hujan</span>
                <div><span class="sum-value" id="rain-val-Aceh">0</span> <span class="sum-unit">mm</span></div>
                <span class="sum-date" id="rain-date-Aceh">-</span>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-C1" onclick="bukaModalStatus('C1')">STBY</span><img src="pk_snp.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-SNP</h3><p class="pesawat-sub">PT. SCA</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-C1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-C1">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-C1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-C1">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-C1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-C1">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-C1">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-C2" onclick="bukaModalStatus('C2')">STBY</span><img src="pk_dpi.png" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-DPI</h3><p class="pesawat-sub">PT. AAI</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-C2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-C2">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-C2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-C2">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-C2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-C2">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-C2">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-C3" onclick="bukaModalStatus('C3')">STBY</span><img src="pk_snk.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-SNK</h3><p class="pesawat-sub">PT. SCA</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-C3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-C3">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-C3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-C3">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-C3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-C3">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-C3">-</span></div></div></div>
        </div>
    </div>

    <div class="province-section">
        <div class="location-banner"><div class="location-pill"><i class="fa-solid fa-location-dot"></i> Provinsi Sumatera Utara</div></div>
        <div class="summary-wrapper">
            <div class="summary-card sum-sortie"><span class="sum-label">Sortie</span><div class="sum-value" id="total-sortie-sumut">0</div></div>
            <div class="summary-card sum-nacl"><span class="sum-label">NaCl</span><div><span class="sum-value" id="total-nacl-sumut">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-cao"><span class="sum-label">CaO</span><div><span class="sum-value" id="total-cao-sumut">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-total"><span class="sum-label">Total Bahan</span><div><span class="sum-value" id="total-semai-sumut">0</span> <span class="sum-unit">Kg</span></div></div>
            
            <div class="summary-card sum-rain">
                <span class="sum-label">Curah Hujan</span>
                <div><span class="sum-value" id="rain-val-Sumut">0</span> <span class="sum-unit">mm</span></div>
                <span class="sum-date" id="rain-date-Sumut">-</span>
            </div>
        </div>
        <div class="dashboard-container">
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-A1" onclick="bukaModalStatus('A1')">STBY</span><img src="pk_dpi.png" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-DPI</h3><p class="pesawat-sub">PT. AAI</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-A1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-A1">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-A1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-A1">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-A1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-A1">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-A1">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-A2" onclick="bukaModalStatus('A2')">STBY</span><img src="pk_scj.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-SCJ</h3><p class="pesawat-sub">PT. MPB</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-A2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-A2">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-A2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-A2">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-A2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-A2">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-A2">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-A3" onclick="bukaModalStatus('A3')">STBY</span><img src="pk_yna.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-YNA</h3><p class="pesawat-sub">PT. SAM</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-A3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-A3">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-A3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-A3">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-A3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-A3">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-A3">-</span></div></div></div>
        </div>
    </div>

    <div class="province-section">
        <div class="location-banner"><div class="location-pill"><i class="fa-solid fa-location-dot"></i> Provinsi Sumatera Barat</div></div>
        <div class="summary-wrapper">
            <div class="summary-card sum-sortie"><span class="sum-label">Sortie</span><div class="sum-value" id="total-sortie-sumbar">0</div></div>
            <div class="summary-card sum-nacl"><span class="sum-label">NaCl</span><div><span class="sum-value" id="total-nacl-sumbar">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-cao"><span class="sum-label">CaO</span><div><span class="sum-value" id="total-cao-sumbar">0</span> <span class="sum-unit">Kg</span></div></div>
            <div class="summary-card sum-total"><span class="sum-label">Total Bahan</span><div><span class="sum-value" id="total-semai-sumbar">0</span> <span class="sum-unit">Kg</span></div></div>
            
            <div class="summary-card sum-rain">
                <span class="sum-label">Curah Hujan</span>
                <div><span class="sum-value" id="rain-val-Sumbar">0</span> <span class="sum-unit">mm</span></div>
                <span class="sum-date" id="rain-date-Sumbar">-</span>
            </div>
        </div>
        <div class="dashboard-container">
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-B1" onclick="bukaModalStatus('B1')">STBY</span><img src="pk_dpi.png" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-DPI</h3><p class="pesawat-sub">PT. AAI</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-B1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-B1">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-B1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-B1">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-B1">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-B1">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-B1">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-B2" onclick="bukaModalStatus('B2')">STBY</span><img src="pk_snk.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-SNK</h3><p class="pesawat-sub">PT. SCA</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-B2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-B2">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-B2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-B2">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-B2">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-B2">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-B2">-</span></div></div></div>
            <div class="card"><div class="image-wrapper"><span class="status-badge stby" id="status-B3" onclick="bukaModalStatus('B3')">STBY</span><img src="pk_akr.jpg" class="card-image"></div><div class="card-body"><div class="pesawat-header"><h3 class="pesawat-name">PK-AKR</h3><p class="pesawat-sub">PT. RPI</p></div><div class="stats-grid"><div class="stat-box"><span class="stat-label">Sortie</span><span class="stat-val" id="sortie-B3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_sortie-B3">0</span></div><div class="stat-box"><span class="stat-label">NaCl</span><span class="stat-val" id="nacl-B3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_nacl-B3">0</span></div><div class="stat-box"><span class="stat-label">CaO</span><span class="stat-val" id="cao-B3">0</span></div><div class="stat-box"><span class="stat-label">Total</span><span class="stat-val" id="acc_cao-B3">0</span></div></div><div class="target-box"><i class="fa-solid fa-crosshairs"></i> <span id="target-B3">-</span></div></div></div>
        </div>
    </div>

    <script>
        // Gunakan Config Netlify (atau config.js lokal)
        const SCRIPT_URL = (typeof CONFIG !== 'undefined') ? CONFIG.SCRIPT_URL : "URL_SCRIPT_ANDA_JIKA_CONFIG_GAGAL"; 
        
        let pesawatDipilih = "";

        // Fungsi Switch Status (Modal)
        function bukaModalStatus(kode) { 
            pesawatDipilih = kode; 
            document.getElementById('modalKodePesawat').innerText = kode;
            document.getElementById('statusModal').style.display = 'flex'; 
        }
        
        function tutupModal() { 
            document.getElementById('statusModal').style.display = 'none'; 
        }
        
        function updateStatus(statusBaru) {
            document.querySelector('.modal-box').innerHTML = '<i class="fa-solid fa-spinner fa-spin" style="font-size:2rem; color:var(--accent)"></i><p>Updating...</p>';
            fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "update_status", kode: pesawatDipilih, status: statusBaru }) })
            .then(r => r.json()).then(res => { location.reload(); }).catch(e => { alert("Koneksi Error"); location.reload(); });
        }

        async function loadData() {
            try {
                let response = await fetch(SCRIPT_URL);
                let result = await response.json(); 
                
                // === PERBAIKAN DI SINI ===
                // Data sekarang berbentuk { flights: [...], weather: {...} }
                // Kita harus membongkarnya. Jika masih format lama (array), pakai fallback.
                let flights = result.flights ? result.flights : (Array.isArray(result) ? result : []);
                let weather = result.weather ? result.weather : {};

                let sSortieAceh=0, sNaClAceh=0, sCaOAceh=0;
                let sSortieSumut=0, sNaClSumut=0, sCaOSumut=0;
                let sSortieSumbar=0, sNaClSumbar=0, sCaOSumbar=0;

                // 1. ISI DATA PESAWAT
                flights.forEach(data => {
                    let k = data.kode;
                    if(document.getElementById('target-' + k)) {
                        document.getElementById('target-'+k).innerText = data.target || "-";
                        document.getElementById('sortie-'+k).innerText = data.sortie;
                        document.getElementById('acc_sortie-'+k).innerText = data.acc_sortie;
                        document.getElementById('nacl-'+k).innerText = parseInt(data.nacl).toLocaleString('id-ID');
                        document.getElementById('acc_nacl-'+k).innerText = parseInt(data.acc_nacl).toLocaleString('id-ID');
                        document.getElementById('cao-'+k).innerText = parseInt(data.cao).toLocaleString('id-ID');
                        document.getElementById('acc_cao-'+k).innerText = parseInt(data.acc_cao).toLocaleString('id-ID');

                        let badge = document.getElementById('status-'+k);
                        badge.innerText = data.status == 'off' ? 'OFF' : data.status.toUpperCase();
                        badge.className = 'status-badge ' + data.status;
                    }

                    // Hitung Total Per Provinsi
                    if(k.startsWith('C')) { sSortieAceh += parseInt(data.acc_sortie)||0; sNaClAceh += parseInt(data.acc_nacl)||0; sCaOAceh += parseInt(data.acc_cao)||0; }
                    if(k.startsWith('A')) { sSortieSumut += parseInt(data.acc_sortie)||0; sNaClSumut += parseInt(data.acc_nacl)||0; sCaOSumut += parseInt(data.acc_cao)||0; }
                    if(k.startsWith('B')) { sSortieSumbar += parseInt(data.acc_sortie)||0; sNaClSumbar += parseInt(data.acc_nacl)||0; sCaOSumbar += parseInt(data.acc_cao)||0; }
                });

                // 2. UPDATE KARTU SUMMARY PESAWAT
                if(document.getElementById("total-sortie-aceh")) {
                    document.getElementById("total-sortie-aceh").innerText = sSortieAceh;
                    document.getElementById("total-nacl-aceh").innerText = sNaClAceh.toLocaleString('id-ID');
                    document.getElementById("total-cao-aceh").innerText = sCaOAceh.toLocaleString('id-ID');
                    document.getElementById("total-semai-aceh").innerText = (sNaClAceh + sCaOAceh).toLocaleString('id-ID');
                }
                if(document.getElementById("total-sortie-sumut")) {
                    document.getElementById("total-sortie-sumut").innerText = sSortieSumut;
                    document.getElementById("total-nacl-sumut").innerText = sNaClSumut.toLocaleString('id-ID');
                    document.getElementById("total-cao-sumut").innerText = sCaOSumut.toLocaleString('id-ID');
                    document.getElementById("total-semai-sumut").innerText = (sNaClSumut + sCaOSumut).toLocaleString('id-ID');
                }
                if(document.getElementById("total-sortie-sumbar")) {
                    document.getElementById("total-sortie-sumbar").innerText = sSortieSumbar;
                    document.getElementById("total-nacl-sumbar").innerText = sNaClSumbar.toLocaleString('id-ID');
                    document.getElementById("total-cao-sumbar").innerText = sCaOSumbar.toLocaleString('id-ID');
                    document.getElementById("total-semai-sumbar").innerText = (sNaClSumbar + sCaOSumbar).toLocaleString('id-ID');
                }

                // 3. UPDATE KARTU CUACA (HUJAN)
                if (weather) {
                    if (weather.Aceh) {
                        document.getElementById('rain-val-Aceh').innerText = weather.Aceh.mm;
                        document.getElementById('rain-date-Aceh').innerText = "Update: " + weather.Aceh.tgl;
                    }
                    if (weather.Sumut) {
                        document.getElementById('rain-val-Sumut').innerText = weather.Sumut.mm;
                        document.getElementById('rain-date-Sumut').innerText = "Update: " + weather.Sumut.tgl;
                    }
                    if (weather.Sumbar) {
                        document.getElementById('rain-val-Sumbar').innerText = weather.Sumbar.mm;
                        document.getElementById('rain-date-Sumbar').innerText = "Update: " + weather.Sumbar.tgl;
                    }
                }

            } catch (e) { console.log("Error loading data:", e); }
        }
        
        window.onload = loadData;
        setInterval(loadData, 10000); 
    </script>

    <div id="statusModal" class="modal-overlay">
        <div class="modal-box">
            <h3>Update Status <span id="modalKodePesawat" style="color:var(--accent)"></span></h3>
            <button class="btn-status-choice" style="background:#27ae60" onclick="updateStatus('stby')">STBY</button>
            <button class="btn-status-choice" style="background:#2980b9" onclick="updateStatus('airborne')">AIRBORNE</button>
            <button class="btn-status-choice" style="background:#c0392b" onclick="updateStatus('maintenance')">MAINTENANCE</button>
            <button class="btn-status-choice" style="background:#555" onclick="updateStatus('off')">OFF / MOVED</button>
            <button class="btn-status-choice btn-cancel" onclick="tutupModal()">Batal</button>
        </div>
    </div>

</body>
</html>